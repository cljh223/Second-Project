<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.kilha.www.dao.LogisticsDAO">
	<select id="loginCheck" parameterType="map" resultType="Staff">
		select * from staff
		where
			staff_code = #{staff_code}
		and
			staff_password = #{staff_password}
	
	</select>

	<insert id="ordering" parameterType="Shipping">
		insert into shipping
		values(
			seq_shipping_orderNum.nextval
			, #{dept}
			, #{goods}
			, #{quantity}
			, #{deliverydate}
			, #{status}
			, #{staff_code}
			, #{shop_code}
			, #{truck_code}
		)
	</insert>
	
	<select id="myOrderList" parameterType="int" resultType="Map">
		select
			s.orderNum
			, s.goods
			, s.quantity
			, sh.shop_name
			, to_char(s.deliverydate, 'YYYY-MM-DD') as deliverydate
			, s.status
		from
			shipping s, shop sh
		where
			s.shop_code = sh.shop_code
		and
			staff_code = #{userid}
		order by
			deliverydate asc
	</select>
	
	<select id="selectOne" parameterType="Integer" resultType="Map">
		select 
			s.dept
			, s.staff_code
			, s.goods
			, s.quantity
			, sh.shop_name 
			, to_char(s.deliverydate, 'YYYY-MM-DD') as deliverydate
			, s.truck_code
		from shipping s, shop sh
		where
			s.shop_code = sh.shop_code
		and
			orderNum = #{orderNum}
	</select>
	
	<select id="resultList" parameterType="String" resultType="map">
		select 
			s.orderNum
			, s.goods
			, s.quantity
			, sh.shop_name 
			, to_char(s.deliverydate, 'YYYY-MM-DD') as deliverydate
			, s.status
		from shipping s, shop sh
		where
			s.shop_code = sh.shop_code
		and
			status = #{status}
		order by
			deliverydate asc
	</select>
	
	<update id="updateList" parameterType="map">
		update shipping
		set
			status = #{changeStatus}
		where
			orderNum = #{orderNum}
	</update>
	
	<delete id="deleteList" parameterType="int">
		delete from shipping
		where
			orderNum = #{orderNum}
	</delete>
	
	<select id="searchDept" parameterType="Int" resultType="Staff">
		select staff_code, staff_department
		from 
			staff
		where
			staff_code = #{userid}
	</select>
	
	<select id="selectTruck" parameterType="Map" resultType="Map">g
		select t.truck_code, sh.shop_name, s.goods, s.quantity, s.status
		from 
			trucklist t, shipping s, shop sh
		where
			t.orderNum = s.orderNum
		and
			s.shop_code = sh.shop_code
		and
			s.deliverydate = #{deliverydate}
		and
			s.shop_code = #{shop_code}
	</select>
	
	<select id="getShopList" resultType="map">
		select shop_code, shop_name
		from
			shop
	</select>
	
	<select id="getTruckList" resultType="String">
		select truck_code
		from 
			truck
	</select>
	
	<select id="reserveTruckList" parameterType="map" resultType="map">
		select s.goods, s.quantity, sh.shop_name, a.address_post, 
			a.address_detail1, a.address_detail2, a.address_detail3, a.address_detail4
		from
			shipping s, shop sh, address a
		where
			s.shop_code = sh.shop_code
		and
			sh.shop_code = a.shop_code
		and
			s.deliverydate = #{dDate}
		and
			s.truck_code = #{truck}
	</select>
	
	<select id="truckCapa" parameterType="String" resultType="truck">
		select width, length, height
		from
			truck
		where
			truck_code = #{truck_code}
	</select>
	
	<select id="originQCapa" parameterType="String" resultType="int">
		select quantity
		from 
			shipping
		where
			truck_code = #{truck_code}
	</select>
	
	<update id="updateShipping" parameterType="Shipping" >
		update shipping
		set
			goods = #{goods}
			, quantity = #{quantity}
			, deliverydate = #{deliverydate}
			, shop_code = #{shop_code}
			, truck_code = #{truck_code}
		where
			orderNum = #{orderNum}
	</update>
	
	<select id="truckListSearch" parameterType="map" resultType="map">
		select sh.shop_name, s. goods, s.quantity
		from 
			shipping s, shop sh
		where
			s.shop_code = sh.shop_code
		and
			s.deliverydate = #{deliverydate}
		and
			s.truck_code = #{truck_code}
	</select>
	
</mapper>

